<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KIG: Minimal Working Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="color_override.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="KIGS_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">KIG
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Doc_Example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Minimal Working Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this page, you will be guided through a minimal working example of KIG. For further informations about single functions and structs, please refer to Documentation.</p>
<div class="fragment"><div class="line">#include &quot;greenHPC.h&quot;</div>
<div class="line">#define BUFFER_SIZE &lt;user_defined_INT&gt;</div>
<div class="line">std::string config_f = &quot;&lt;a_valid_location&gt;&quot;</div>
<div class="line">struct sysinfo s_info;</div>
</div><!-- fragment --><p> This preamble sets everything for the correct usage of KIG. The <code>BUFFER_SIZE</code> is used to pre-reserve some memory for vectors to improve performance. Since vectors are flexible by design, any value choice will fit. <code>config_f</code> is the location of the machine configuration file, the user/datacenter should know it. <code>s_info</code> is a C struct that contains system information such as uptime.</p>
<p>Then we have the main() function: </p><div class="fragment"><div class="line">int main (int argc, char** argv)</div>
</div><!-- fragment --><p> where the parameter received at launch will be the PID of the process we want to analyze.</p>
<div class="fragment"><div class="line">HWconfig conf;</div>
<div class="line">CPUsage monitor;</div>
<div class="line">pullConfig(conf, config_f);</div>
</div><!-- fragment --><p> We set the structures and fill the <a class="el" href="structHWconfig.html" title="This data structure contains the information fetched from the TOML configuration file....">HWconfig</a> object with the content of the .toml file.</p>
<div class="fragment"><div class="line">std::vector&lt;std::string&gt; proc_buffer;</div>
<div class="line">std::vector&lt;double&gt; cpu_usage_buffer;</div>
<div class="line">std::vector&lt;double&gt; mem_allocation;</div>
</div><!-- fragment --><p> We declare 3 vectors that will play the role of data buffers. Optionally we can <code>vector_name.reserve(BUFFER_SIZE)</code> to pre-allocate some memory for them and make them more reactive.</p>
<div class="fragment"><div class="line">auto pid = std::string(argv[1]);</div>
<div class="line">auto path = conf.root_folder + pid + conf.cpu_stat_file;</div>
<div class="line">auto path_mem = conf.root_folder + pid + conf.mem_stat_file;</div>
<div class="line"> </div>
<div class="line">std::filesystem::path PROCESS_FOLDER {path};</div>
</div><!-- fragment --><p> the two path variables are built concatenating std::string variables. <code>path</code> will be something like "proc/$pid/stat" and <code>path_mem</code> will be something like "proc/$pid/status".</p>
<p>finally we build <code>PROCESS_FOLDER</code> to use it as control value to check the existance of the path, since when the process delivers, the PID gets retired and the folder tree is not valid anymore.</p>
<div class="fragment"><div class="line">do {</div>
<div class="line">    fillBuffer(monitor, proc_buffer, path);</div>
<div class="line">    mem_allocation.push_back(fetchMem(path_mem));</div>
<div class="line">    update(monitor, proc_buffer, s_info);</div>
<div class="line">    cpu_usage_buffer.push_back(CPUusage(monitor, conf));</div>
<div class="line">    flushBuffer(proc_buffer);</div>
<div class="line">    sleep(10);</div>
<div class="line">    } while (std::filesystem::exists(PROCESS_FOLDER));</div>
</div><!-- fragment --><p> This do-while starts the data gathering routine. Each function is documented, please refer to the file documentation for further details. At the end of the execution, we are ready for Carbon Footprint evaluation.</p>
<div class="fragment"><div class="line">auto footprint = carbonFootprint(cpu_usage_buffer, mem_allocation, conf,</div>
<div class="line">monitor.elapsed_time);</div>
</div><!-- fragment --><p> And finally, if needed, we can call</p>
<div class="fragment"><div class="line">makeReport(conf, monitor.elapsed_time, footprint);</div>
</div><!-- fragment --><p> To generate the code of a report table in LaTeX. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
